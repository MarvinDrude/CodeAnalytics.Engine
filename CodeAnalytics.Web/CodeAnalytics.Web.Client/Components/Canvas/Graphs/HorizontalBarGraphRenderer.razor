@using CodeAnalytics.Web.Client.Components.Canvas.Common
@using CodeAnalytics.Web.Common.Models.Canvas
@using CodeAnalytics.Web.Common.Models.Canvas.Common
@using CodeAnalytics.Web.Common.Models.Canvas.Graphs

<CanvasRenderer Render="@OnRender" Width="@Width" Height="@Height"></CanvasRenderer>

@code {
   
   [Parameter] 
   public int Width { get; set; } = -1;
   [Parameter] 
   public int Height { get; set; } = 200;
   
   [Parameter] 
   public BoundingRect Padding { get; set; } = new (10, 0, 10, 0);
   
   [Parameter, EditorRequired]
   public required List<ValueGraphNode> Nodes { get; set; }

   private void OnRender(CanvasContext ctx)
   {
      var total = Nodes.Sum(x => x.Value);
      var rangeX = ctx.Width - (Padding.Left + Padding.Right);
      var rangeY = ctx.Height - (Padding.Top + Padding.Bottom);

      var startX = Padding.Left;

      foreach (var node in Nodes)
      {
         var perc = node.Value / total;
         var width = perc * rangeX;
         
         ctx.BeginPath();
         ctx.Rect(startX, Padding.Top, (float)width, rangeY);
         
         ctx.ClosePath();
         ctx.FillStyle(node.Color);
         ctx.Fill();

         startX += (float)width;
      }
   }
   
}